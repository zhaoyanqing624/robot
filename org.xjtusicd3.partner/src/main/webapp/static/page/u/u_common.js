define(function(require){function c(c,a,g){function v(c){if(document.selection){y.focus();var a=document.selection.createRange();a.text=c,a.collapse(),a.select()}else if(y.selectionStart||"0"==y.selectionStart){var g=y.selectionStart,v=y.selectionEnd;y.value=y.value.substring(0,g)+c+y.value.substring(v,y.value.length),y.selectionStart=y.selectionEnd=g+c.length}else y.value+=c}function h(){$(document).on("click",function(c){if("face_panel"!==c.target.id)$("#face_panel").hide();else{var g=$(a)[0];g.focus()}})}var _=[{title:"[微笑]",pic:g+"1.png"},{title:"[不]",pic:g+"2.png"},{title:"[亲亲]",pic:g+"3.png"},{title:"[无聊]",pic:g+"4.png"},{title:"[鼓掌]",pic:g+"5.png"},{title:"[伤心]",pic:g+"6.png"},{title:"[害羞]",pic:g+"7.png"},{title:"[闭嘴]",pic:g+"8.png"},{title:"[耍酷]",pic:g+"9.png"},{title:"[无语]",pic:g+"10.png"},{title:"[发怒]",pic:g+"11.png"},{title:"[惊讶]",pic:g+"12.png"},{title:"[委屈]",pic:g+"13.png"},{title:"[酷]",pic:g+"14.png"},{title:"[汗]",pic:g+"15.png"},{title:"[闪]",pic:g+"16.png"},{title:"[放屁]",pic:g+"17.png"},{title:"[洗澡]",pic:g+"18.png"},{title:"[偶耶]",pic:g+"19.png"},{title:"[困]",pic:g+"20.png"},{title:"[咒骂]",pic:g+"21.png"},{title:"[疑问]",pic:g+"22.png"},{title:"[晕]",pic:g+"23.png"},{title:"[衰]",pic:g+"24.png"},{title:"[装鬼]",pic:g+"25.png"},{title:"[受伤]",pic:g+"26.png"},{title:"[再见]",pic:g+"27.png"},{title:"[抠鼻]",pic:g+"28.png"},{title:"[心寒]",pic:g+"29.png"},{title:"[怒]",pic:g+"30.png"},{title:"[凄凉]",pic:g+"31.png"},{title:"[悄悄]",pic:g+"32.png"},{title:"[奋斗]",pic:g+"33.png"},{title:"[哭]",pic:g+"34.png"},{title:"[赞]",pic:g+"35.png"},{title:"[开心]",pic:g+"36.png"}];c.stopPropagation();({left:c.pageX-10,top:c.pageY-300});if($("#face_panel").size()>0)$("#face_panel").fadeIn(function(){h()});else{var y=$(a)[0];$("#layer_sendmsg").css("position","relative"),$('<div id="face_panel" style="display:block;left:-70px;bottom:50px; z-index:99999999; margin:0"><div id="choose_face"></div></div>').appendTo($("#layer_sendmsg"));for(var i=0;i<_.length;i++){var C=_[i].title.substr(1).replace("]","");$('<a title="'+_[i].title+'"  href="javascript:;"><img class="ph_face_s" src='+_[i].pic+"><p>"+C+"</p></a>").appendTo($("#choose_face")).on("click",function(c){c.stopPropagation(),v($(this).attr("title")),$("#face_panel").hide()})}h()}}function a(c){if(document.selection){j.focus();var a=document.selection.createRange();a.text=c,a.collapse(),a.select()}else if(j.selectionStart||"0"==j.selectionStart){var g=j.selectionStart,v=j.selectionEnd;j.value=j.value.substring(0,g)+c+j.value.substring(v,j.value.length),j.selectionStart=j.selectionEnd=g+c.length}else j.value+=c}function g(c,a){if(""==$("#textInput").val())return void alert("请输入内容");var g=$("#textInput").val();$.ajax({type:"post",url:c,dataType:"json",data:{uid:a,message:g},success:function(c){layer.close(k),k="",layer.msg(c.data.msg,1,1)}})}var v,h,_,y,C=document,I=window,w=!0;$(function(){$(I).height()>720&&$(I).on("scroll",function(){if(w){var c=115,a=$(".slider"),g=$(".wrap").offset().left,v=$(I).scrollTop();v>c?(a.find(".set-btn").hide(),a.find(".img").addClass("suimg"),a.find(".user-pic-bg").addClass("su-user-pic-bg"),a.find(".friend").addClass("r30"),a.css("position","fixed").css("left",g+"px").css("top",0)):(a.find(".set-btn").show(),a.find(".img").removeClass("suimg"),a.find(".user-pic-bg").removeClass("su-user-pic-bg"),a.find(".friend").removeClass("r30"),a.css("position","absolute").css("left","0").css("top","-190px"))}}),$(window).resize(function(){if($(window).height()>720)w=!0;else{w=!1;var c=$(".slider");c.css("position","absolute").css("left","0").css("top","0px")}}),$(".signicon").hover(function(){$(this).find("span").show()},function(){$(this).find("span").hide()})}),require("/static/lib/layer/1.6.0/layer.min.js");var k="",j=$("#textInput")[0];$("#face_panel").find("a").each(function(){$(this).click(function(){$("#face_panel").hide(),a("["+$(this).attr("title")+"]")})}),$(".chatSend").click(function(e){return e.preventDefault(),g("/u/ajaxsendmessage",$("#js-send-msg").data("uid")),!1}),$(".sendInvite").click(function(e){return e.preventDefault(),g("/u/ajaxaddfriend",$("#js-add-frd").data("uid")),!1}),$("#main").delegate("#js-add-frd, #js-send-msg","click",function(){function c(){require.async("login_sns",function(c){c.init()})}OP_CONFIG.userInfo?($("#textInput").val(""),k=$.layer({type:1,area:["js-send-msg"==$(this).attr("id")?"580px":"422px","auto"],title:!1,move:[".layer_notice",!0],border:!1,page:{dom:"#layer_sendmsg"}}),$(".xubox_main").addClass("pravtie_close")):c()}),$(".tipclose").click(function(){$(".addfriendtip").css("display","none")}),$(".suclose").click(function(){$(".successtip").css("display","none")}),$(C).delegate("#sendEmojiIcon","click",function(e){var a=$("#textInput");return a.focus(),$("#face_panel").length>0?$("#face_panel").toggle():c(e,a,"/static/img/smiley/"),!1}),_=function(){y()},y=function(){$(C).on("mouseenter",".user-pic .friend",v.iconHandlerIn),$(C).on("mouseleave",".user-pic .friend",v.iconHandlerOut),$(C).on("click",".user-pic .friend",v.followIconClick),$(C).on("click",".user-pic .cancel-follow",v.cancelFollowClick)};var b=0;v={iconHandlerIn:function(){var c=$(this),a=c.find(".u-info-tips");a.show()},iconHandlerOut:function(){var c=$(this),a=c.find(".u-info-tips");a.hide()},followIconClick:function(){var c=$(this),a=c.data("type"),g=c.data("uid"),v=c.parent(),_=$(".user-pic .js-already-follow"),y=$(".user-pic .js-fans-msg"),C=v.data("is-fans");b||(OP_CONFIG.userInfo?(b=1,1==a&&h({url:"/u/"+OP_CONFIG.userInfo.uid+"/ajaxfollows",uid:g,type:1},function(){C&&(c.addClass("hide"),y.removeClass("hide")),C||(c.addClass("hide"),_.removeClass("hide")),usersInfoCache&&usersInfoCache[g]&&(usersInfoCache[g].is_follows=1)})):require.async("login_sns",function(c){c.init()}))},cancelFollowClick:function(){var c=$(this),a=$(this).parents(".u-info-tips"),g=c.data("uid"),v=$(".user-pic .js-add-follow");a.hide(),h({url:"/u/"+OP_CONFIG.userInfo.uid+"/ajaxfollows",uid:g,type:2},function(){c.addClass("hide"),v.removeClass("hide"),usersInfoCache&&usersInfoCache[g]&&(usersInfoCache[g].is_follows=0)})}},h=function(c,a){var g={ok:{v:1101,_msg:"关注成功"},error:{v:1100,_msg:"关注失败"}},v={ok:{v:1201,_msg:"取消成功"},error:{v:1200,_msg:"取消失败"}},h={v:1103,_msg:"已经是好友了"};$.ajax({type:"post",url:c.url,dataType:"json",data:{uid:c.uid,type:c.type},success:function(c){c&&c.result?c.result==g.ok.v?a&&a():c.result==g.error.v?layer.msg(c.msg?c.msg:g.error._msg,1,1):c.result==v.ok.v?a&&a():c.result==v.error.v?layer.msg(c.msg?c.msg:v.error._msg,1,1):c.result==h.v?layer.msg(c.msg?c.msg:h._msg,1,1):layer.msg(c.msg,1,1):console.log("系统错误——"+c)},error:function(){layer.msg("网络错误，请稍后再试",1,1)},complete:function(){b=0}})},_()});